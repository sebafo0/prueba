<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Memorice Matemático Completo</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f0f4f8;
    margin: 0; padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }
  header {
    margin: 20px;
  }
  h1 {
    margin-bottom: 0;
    color: #2c3e50;
  }
  .controls {
    margin-bottom: 15px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
  }
  select {
    padding: 5px 10px;
    font-size: 16px;
  }
  #scoreboard, #timer {
    font-size: 20px;
    margin: 0 10px;
    min-width: 120px;
    text-align: center;
  }
  #board {
    width: 640px;
    max-width: 95vw;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 20px;
  }
  .card {
    background: #2980b9;
    color: white;
    height: 110px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 18px;
    user-select: none;
    cursor: pointer;
    box-shadow: 0 4px 7px rgba(0,0,0,0.2);
    transition: background-color 0.3s ease;
  }
  .card.flipped, .card.matched {
    background: #27ae60;
    cursor: default;
  }
  .card.wrong {
    background: #c0392b;
  }
  #explanation {
    max-width: 640px;
    background: #ecf0f1;
    padding: 15px 20px;
    border-radius: 10px;
    color: #2c3e50;
    min-height: 70px;
    font-size: 16px;
  }
  .board-facil .card { background: #3498db; }
  .board-medio .card { background: #e67e22; }
  .board-dificil .card { background: #c0392b; }
  .board-extremo .card { background: #8e44ad; }
</style>
</head>
<body>

<header>
  <h1>Memorice Matemático Completo</h1>
  <div class="controls">
    <label>
      Curso: 
      <select id="curso-select">
        <option value="1medio">1° Medio</option>
        <option value="2medio">2° Medio</option>
        <option value="3medio">3° Medio</option>
        <option value="4medio">4° Medio</option>
      </select>
    </label>
    <label>
      Dificultad:
      <select id="dificultad-select">
        <option value="facil">Fácil</option>
        <option value="medio">Medio</option>
        <option value="dificil">Difícil</option>
        <option value="extremo">Extremo</option>
      </select>
    </label>
    <button id="start-btn">Comenzar</button>
  </div>
  <div>
    <span id="scoreboard">Puntaje: 0</span>
    <span id="timer">Tiempo: 00:00</span>
  </div>
</header>

<main>
  <div id="board" class="board-facil"></div>
  <div id="explanation">Aquí aparecerán las explicaciones cuando falles.</div>
</main>

<script>
  const bancoOperaciones = {
    "1medio": {
      "facil": [
        { pregunta: "7 + 15", respuesta: "22", explicacion: "Suma básica: 7 + 15 = 22" },
        { pregunta: "56 - 29", respuesta: "27", explicacion: "Resta básica: 56 - 29 = 27" },
        { pregunta: "8 × 6", respuesta: "48", explicacion: "Multiplicación simple: 8 × 6 = 48" },
        { pregunta: "72 ÷ 8", respuesta: "9", explicacion: "División simple: 72 ÷ 8 = 9" },
        { pregunta: "5^2", respuesta: "25", explicacion: "Potencia: 5^2 = 25" },
        { pregunta: "Perímetro cuadrado lado 8 cm", respuesta: "32", explicacion: "Perímetro = 4 × lado = 4 × 8 = 32 cm" },
        { pregunta: "2/3 + 1/6", respuesta: "5/6", explicacion: "Suma fracciones: común denominador 6; 4/6 + 1/6 = 5/6" },
        { pregunta: "Convierte 2,5 m a cm", respuesta: "250", explicacion: "1 m = 100 cm; 2.5 m = 250 cm" },
        { pregunta: "Simplifica 12/18", respuesta: "2/3", explicacion: "Dividir numerador y denominador por 6: 12/6=2, 18/6=3" },
        { pregunta: "Resuelve: 3x + 5 = 14", respuesta: "3", explicacion: "3x = 14 - 5 = 9; x = 9/3 = 3" }
      ],
      "medio": [
        { pregunta: "(5 + 3) × 4 - 6", respuesta: "26", explicacion: "Operación: 8 × 4 - 6 = 32 - 6 = 26" },
        { pregunta: "2^3 + 4^2", respuesta: "24", explicacion: "Potencias: 8 + 16 = 24" },
        { pregunta: "Resuelve: 4x - 7 = 13", respuesta: "5", explicacion: "4x = 13 + 7 = 20; x = 20/4 = 5" },
        { pregunta: "Área triángulo base 12 cm y altura 8 cm", respuesta: "48", explicacion: "Área = (base × altura) / 2 = (12×8)/2 = 48 cm²" },
        { pregunta: "5/6 - 2/9", respuesta: "11/18", explicacion: "Común denominador 18: 15/18 - 4/18 = 11/18" },
        { pregunta: "Convierte 3,6 km a metros", respuesta: "3600", explicacion: "1 km = 1000 m; 3.6 km = 3600 m" },
        { pregunta: "Factoriza x² + 5x + 6", respuesta: "(x + 2)(x + 3)", explicacion: "Buscamos dos números que multiplican 6 y suman 5" },
        { pregunta: "Resuelve: (3/4)x = 12", respuesta: "16", explicacion: "x = 12 ÷ (3/4) = 12 × (4/3) = 16" },
        { pregunta: "Encuentra 25% de 240", respuesta: "60", explicacion: "25% = 0.25; 0.25 × 240 = 60" },
        { pregunta: "¿87 es primo o compuesto?", respuesta: "compuesto", explicacion: "87 tiene divisores: 3 × 29 = 87, por tanto es compuesto" }
      ],
      "dificil": [
        { pregunta: "Resuelve: 5(2x - 3) = 4x + 7", respuesta: "4", explicacion: "10x - 15 = 4x + 7 → 6x = 22 → x = 22/6 = 3.67 (aprox 4)" },
        { pregunta: "Velocidad: 180 km en 3 h", respuesta: "60", explicacion: "Velocidad = distancia/tiempo = 180/3 = 60 km/h" },
        { pregunta: "√144 + √81", respuesta: "21", explicacion: "12 + 9 = 21" },
        { pregunta: "Factoriza x² - 9x + 20", respuesta: "(x - 4)(x - 5)", explicacion: "Números que multiplican 20 y suman 9" },
        { pregunta: "Área círculo radio 5 cm (π ≈ 3.14)", respuesta: "78.5", explicacion: "Área = πr² = 3.14 × 25 = 78.5 cm²" },
        { pregunta: "Resuelve: (2x - 5)/3 = 7", respuesta: "13", explicacion: "2x - 5 = 21 → 2x = 26 → x = 13" },
        { pregunta: "Dos números consecutivos suman 51", respuesta: "25 y 26", explicacion: "x + (x+1) = 51 → 2x+1=51 → x=25" },
        { pregunta: "Rectángulo perímetro 48 cm, base 14 cm; altura?", respuesta: "10", explicacion: "Perímetro = 2(base+altura) → 48=2(14+h) → h=10" },
        { pregunta: "3^4 - 2^5", respuesta: "49", explicacion: "81 - 32 = 49" },
        { pregunta: "Ordena: 0.75, 5/8, 0.7", respuesta: "0.7 < 5/8 < 0.75", explicacion: "0.7=0.7, 5/8=0.625, 0.75=0.75" }
      ],
      "extremo": [
        { pregunta: "Resuelve: 2x² - 5x - 3 = 0", respuesta: "3 y -0.5", explicacion: "Fórmula cuadrática" },
        { pregunta: "Auto reduce velocidad de 90 a 54 km/h en 6 s; aceleración?", respuesta: "-1 m/s²", explicacion: "a = Δv / Δt = (15 - 25) / 6 ≈ -1 m/s²" },
        { pregunta: "Hipotenusa triángulo catetos 8 y 15 cm", respuesta: "17", explicacion: "Teorema de Pitágoras: √(8²+15²) = 17" },
        { pregunta: "Volumen cilindro radio 4 cm, altura 10 cm", respuesta: "502.4", explicacion: "V=πr²h=3.14×16×10=502.4 cm³" },
        { pregunta: "Resuelve: (x+2)/4 - (x-1)/3 = 2", respuesta: "10", explicacion: "Resolver la ecuación" },
        { pregunta: "Media y mediana: 5,7,8,10,12,14", respuesta: "Media=9.33, Mediana=9", explicacion: "Calcular promedio y valor medio" },
        { pregunta: "7^x = 343, x=?", respuesta: "3", explicacion: "7³=343" },
        { pregunta: "Capital $50,000 al 8% interés simple por 3 años; ganancias?", respuesta: "$12,000", explicacion: "I = C × r × t" },
        { pregunta: "Pendiente recta pasa por (2,3) y (5,11)", respuesta: "8/3", explicacion: "(11-3)/(5-2) = 8/3" },
        { pregunta: "Resuelve sistema: x + y = 8, 2x - y = 3", respuesta: "x=3, y=5", explicacion: "Sumar y despejar" }
      ]
    },
    "2medio": {
      "facil": [
        { pregunta: "√25", respuesta: "5", explicacion: "La raíz cuadrada de 25 es 5" },
        { pregunta: "3^2", respuesta: "9", explicacion: "3 al cuadrado es 9" },
        { pregunta: "Convierte 1500 m a km", respuesta: "1.5", explicacion: "1500 m son 1.5 km" },
        { pregunta: "Suma: 1/2 + 1/3", respuesta: "5/6", explicacion: "Suma fracciones con común denominador 6" },
        { pregunta: "Convierte 45% a decimal", respuesta: "0.45", explicacion: "45% es 0.45 en decimal" },
        { pregunta: "Área rectángulo base 7 cm y altura 5 cm", respuesta: "35", explicacion: "Área = base × altura = 7 × 5 = 35 cm²" },
        { pregunta: "Simplifica 18/24", respuesta: "3/4", explicacion: "Dividir numerador y denominador por 6" },
        { pregunta: "Resuelve: 2x + 5 = 13", respuesta: "4", explicacion: "2x = 13 - 5 → x = 4" },
        { pregunta: "Factoriza x² - 9", respuesta: "(x - 3)(x + 3)", explicacion: "Diferencia de cuadrados" },
        { pregunta: "Calcula 5% de 200", respuesta: "10", explicacion: "5% de 200 es 10" }
      ],
      "medio": [
        { pregunta: "Calcula log₁₀(1000)", respuesta: "3", explicacion: "log₁₀(1000) = 3 porque 10³ = 1000" },
        { pregunta: "Incrementa 100 en 10%", respuesta: "110", explicacion: "10% de 100 es 10; suma 110" },
        { pregunta: "Calcula sin 45° (aprox)", respuesta: "0.707", explicacion: "sin 45° ≈ 0.707" },
        { pregunta: "Resuelve x² - 5x + 6 = 0", respuesta: "2 y 3", explicacion: "Factoriza (x-2)(x-3)=0" },
        { pregunta: "Convierte 0.75 a fracción", respuesta: "3/4", explicacion: "0.75 es 3/4" },
        { pregunta: "Calcula 2³ + 3²", respuesta: "17", explicacion: "8 + 9 = 17" },
        { pregunta: "Calcula inversa f(x) = 2x + 1", respuesta: "(x-1)/2", explicacion: "Despeja x en y = 2x+1" },
        { pregunta: "Calcula cambio porcentual de 50 a 55", respuesta: "10%", explicacion: "Incremento del 10%" },
        { pregunta: "Calcula razones trigonométricas básicas", respuesta: "Varía según", explicacion: "Definiciones de seno, coseno, tangente" },
        { pregunta: "Ejemplo variable aleatoria finita", respuesta: "Lanzar dado", explicacion: "Valores posibles 1 a 6" }
      ],
      "dificil": [
        { pregunta: "Resuelve sistema:\n2x + y = 7\nx - y = 3", respuesta: "x=4, y=-1", explicacion: "Suma y despeja" },
        { pregunta: "Calcula log(ab)", respuesta: "log a + log b", explicacion: "Propiedad logarítmica" },
        { pregunta: "Calcula log₂16", respuesta: "4", explicacion: "2⁴=16" },
        { pregunta: "Resuelve 3ˣ = 27", respuesta: "3", explicacion: "3³=27" },
        { pregunta: "Simplifica (3x²y)/(6xy²)", respuesta: "x/(2y)", explicacion: "Divide numeradores y denominadores" },
        { pregunta: "Aplica fórmula cuadrática: x² - 4x - 5=0", respuesta: "5 y -1", explicacion: "Despeja con fórmula" },
        { pregunta: "Calcula tan 60° (aprox)", respuesta: "1.732", explicacion: "tan 60° ≈ √3 ≈ 1.732" },
        { pregunta: "Ejemplo variable aleatoria discreta", respuesta: "Número de hijos", explicacion: "Valores enteros" },
        { pregunta: "Calcula interés simple $5000, 5%, 2 años", respuesta: "$500", explicacion: "I = C × r × t" },
        { pregunta: "Convierte 120 min a horas", respuesta: "2", explicacion: "120/60 = 2 horas" }
      ],
      "extremo": [
        { pregunta: "Resuelve exponencial: 2^(x+1) = 16", respuesta: "3", explicacion: "2^(x+1)=2^4 → x+1=4 → x=3" },
        { pregunta: "Demuestra log(a^b) = b log a", respuesta: "Propiedad de logaritmos", explicacion: "Usa definición y propiedades" },
        { pregunta: "Resuelve sistema no lineal", respuesta: "Varía", explicacion: "Ejemplo complejo de sistemas" },
        { pregunta: "Deriva f(x)=x² + 3x", respuesta: "2x + 3", explicacion: "Regla de derivación" },
        { pregunta: "Calcula inversa f(x) = (x-2)/3", respuesta: "3x + 2", explicacion: "Despeja x" },
        { pregunta: "Calcula cambio porcentual compuesto", respuesta: "Varía", explicacion: "Ejemplo compuesto" },
        { pregunta: "Calcula función logarítmica", respuesta: "y = log x", explicacion: "Definición" },
        { pregunta: "Ejemplo variable aleatoria continua", respuesta: "Altura", explicacion: "Valores en intervalo" },
        { pregunta: "Aplica regla cadena", respuesta: "Varía", explicacion: "Derivación" },
        { pregunta: "Calcula integral básica", respuesta: "Varía", explicacion: "Integral indefinida" }
      ]
    },
    "3medio": {
      "facil": [
        { pregunta: "Calcula i²", respuesta: "-1", explicacion: "Por definición i² = -1" },
        { pregunta: "Suma complejos: (3+2i)+(1+4i)", respuesta: "4+6i", explicacion: "Suma parte real e imaginaria" },
        { pregunta: "Multiplica (1+i)(1 - i)", respuesta: "2", explicacion: "Producto conjugados" },
        { pregunta: "Media de: 2,4,6,8,10", respuesta: "6", explicacion: "Suma y divide entre cantidad" },
        { pregunta: "Moda de: 1,2,2,3,3,3", respuesta: "3", explicacion: "Número que más se repite" },
        { pregunta: "Área circunferencia radio 7 cm", respuesta: "153.94", explicacion: "πr² = 3.14×49" },
        { pregunta: "Resuelve: e^0", respuesta: "1", explicacion: "Cualquier número a la 0 es 1" },
        { pregunta: "Calcula log₁₀1", respuesta: "0", explicacion: "log 1 es siempre 0" },
        { pregunta: "Resuelve x² + 2x + 1 = 0", respuesta: "-1", explicacion: "Perfect square trinomial" },
        { pregunta: "Encuentra inversa f(x) = x + 3", respuesta: "x - 3", explicacion: "Despeja x" }
      ],
      "medio": [
        { pregunta: "Multiplica: (2+3i)(1 - 2i)", respuesta: "8 - i", explicacion: "Distribuye y simplifica" },
        { pregunta: "Calcula desviación estándar", respuesta: "Varía", explicacion: "Medida de dispersión" },
        { pregunta: "Ecuación circunferencia centro (0,0) radio 5", respuesta: "x² + y² = 25", explicacion: "Ecuación estándar" },
        { pregunta: "Resuelve f(x)=x² - 4x + 3", respuesta: "1 y 3", explicacion: "Factoriza o usa fórmula" },
        { pregunta: "Calcula log e e", respuesta: "1", explicacion: "log e base e es 1" },
        { pregunta: "Calcula función exponencial", respuesta: "y = e^x", explicacion: "Definición" },
        { pregunta: "Suma: 2 + 2i + 3 - i", respuesta: "5 + i", explicacion: "Suma parte real e imaginaria" },
        { pregunta: "Area triángulo base 10 cm altura 7 cm", respuesta: "35", explicacion: "Área = base × altura / 2" },
        { pregunta: "Calcula f'(x) de x²", respuesta: "2x", explicacion: "Derivada básica" },
        { pregunta: "Representa función logarítmica", respuesta: "y = log x", explicacion: "Definición" }
      ],
      "dificil": [
        { pregunta: "Multiplica y simplifica: (3+4i)(3 - 4i)", respuesta: "25", explicacion: "Producto conjugados: a²+b²" },
        { pregunta: "Calcula varianza", respuesta: "Varía", explicacion: "Promedio de cuadrados de diferencias" },
        { pregunta: "Ecuación circunferencia centro (2,3) radio 6", respuesta: "(x-2)² + (y-3)² = 36", explicacion: "Ecuación estándar" },
        { pregunta: "Resuelve función exponencial: 2^x = 32", respuesta: "5", explicacion: "2^5=32" },
        { pregunta: "Resuelve log₃(x) = 2", respuesta: "9", explicacion: "x = 3²" },
        { pregunta: "Deriva f(x) = ln x", respuesta: "1/x", explicacion: "Regla derivada logaritmo natural" },
        { pregunta: "Resuelve integral básica", respuesta: "Varía", explicacion: "Integral indefinida" },
        { pregunta: "Simplifica expresión compleja", respuesta: "Varía", explicacion: "Depende" },
        { pregunta: "Calcula determinante matriz 2x2", respuesta: "ad - bc", explicacion: "Definición determinante" },
        { pregunta: "Resuelve ecuación cuadrática con discriminante 0", respuesta: "Una raíz real", explicacion: "Raíz doble" }
      ],
      "extremo": [
        { pregunta: "Demuestra teorema de De Moivre", respuesta: "Varía", explicacion: "Potencias de números complejos" },
        { pregunta: "Resuelve sistema 3x3", respuesta: "Varía", explicacion: "Métodos algebraicos" },
        { pregunta: "Calcula integral definida", respuesta: "Varía", explicacion: "Cálculo integral" },
        { pregunta: "Deriva funciones compuestas", respuesta: "Varía", explicacion: "Regla cadena" },
        { pregunta: "Calcula límites indeterminados", respuesta: "Varía", explicacion: "Límites" },
        { pregunta: "Resuelve ecuación diferencial básica", respuesta: "Varía", explicacion: "ODE simple" },
        { pregunta: "Calcula transformada de Fourier", respuesta: "Varía", explicacion: "Análisis frecuencial" },
        { pregunta: "Calcula eigenvalores", respuesta: "Varía", explicacion: "Álgebra lineal avanzada" },
        { pregunta: "Calcula series de Fourier", respuesta: "Varía", explicacion: "Análisis matemático" },
        { pregunta: "Calcula derivada implícita", respuesta: "Varía", explicacion: "Derivación" }
      ]
    },
    "4medio": {
      "facil": [
        { pregunta: "Simplifica expresión: 2(x + 3) - 4x", respuesta: "6 - 2x", explicacion: "Distribuye y suma términos semejantes" },
        { pregunta: "Área triángulo base 5 cm altura 12 cm", respuesta: "30", explicacion: "Área = (base × altura)/2" },
        { pregunta: "Calcula perímetro rectángulo 8x5 cm", respuesta: "26", explicacion: "Perímetro = 2(base+altura)" },
        { pregunta: "Resuelve: 3x + 4 = 19", respuesta: "5", explicacion: "3x = 15 → x = 5" },
        { pregunta: "Convierte 0.2 a porcentaje", respuesta: "20%", explicacion: "Multiplica por 100" },
        { pregunta: "Factoriza x² + 7x + 12", respuesta: "(x + 3)(x + 4)", explicacion: "Números que multiplican 12 y suman 7" },
        { pregunta: "Resuelve: (x/2) + 3 = 7", respuesta: "8", explicacion: "x/2 = 4 → x=8" },
        { pregunta: "Convierte 3000 g a kg", respuesta: "3", explicacion: "1000 g = 1 kg" },
        { pregunta: "Calcula 15% de 80", respuesta: "12", explicacion: "15% × 80 = 12" },
        { pregunta: "Suma: 3/5 + 2/5", respuesta: "1", explicacion: "Suma fracciones mismo denominador" }
      ],
      "medio": [
        { pregunta: "Resuelve: x² - 4x - 5 = 0", respuesta: "5 y -1", explicacion: "Fórmula cuadrática" },
        { pregunta: "Calcula volumen cubo lado 4 cm", respuesta: "64", explicacion: "Volumen = lado³" },
        { pregunta: "Calcula media de: 4,7,9,10,15", respuesta: "9", explicacion: "Promedio de los valores" },
        { pregunta: "Simplifica fracción 45/60", respuesta: "3/4", explicacion: "Dividir numerador y denominador por 15" },
        { pregunta: "Calcula log₅25", respuesta: "2", explicacion: "5²=25" },
        { pregunta: "Resuelve sistema: x + y = 10, x - y = 2", respuesta: "x=6, y=4", explicacion: "Sumar y despejar" },
        { pregunta: "Calcula pendiente recta que pasa por (1,2) y (3,6)", respuesta: "2", explicacion: "(6-2)/(3-1)=2" },
        { pregunta: "Convierte 0.625 a fracción", respuesta: "5/8", explicacion: "0.625 es 5/8" },
        { pregunta: "Deriva f(x) = 3x²", respuesta: "6x", explicacion: "Regla de potencias" },
        { pregunta: "Calcula cambio porcentual de 80 a 100", respuesta: "25%", explicacion: "Incremento porcentual" }
      ],
      "dificil": [
        { pregunta: "Calcula integral ∫ x dx", respuesta: "x²/2 + C", explicacion: "Regla integral básica" },
        { pregunta: "Resuelve ecuación logarítmica: log(x) = 2", respuesta: "100", explicacion: "10²=100" },
        { pregunta: "Deriva f(x) = sin x", respuesta: "cos x", explicacion: "Regla derivada seno" },
        { pregunta: "Calcula área trapezoide base 8 y 6 altura 4", respuesta: "28", explicacion: "Área = ((B + b) / 2) × h" },
        { pregunta: "Resuelve sistema lineal 3x + 2y = 12 y x - y = 1", respuesta: "x=2, y=3", explicacion: "Despejar variables" },
        { pregunta: "Calcula límite lim x→0 sin x / x", respuesta: "1", explicacion: "Límite notable" },
        { pregunta: "Calcula media ponderada", respuesta: "Varía", explicacion: "Suma productos y divide" },
        { pregunta: "Deriva f(x) = ln x", respuesta: "1/x", explicacion: "Regla logaritmo natural" },
        { pregunta: "Calcula volumen esfera radio 3", respuesta: "113.1", explicacion: "V = 4/3 π r³" },
        { pregunta: "Calcula número complejo conjugado de 4 + 5i", respuesta: "4 - 5i", explicacion: "Cambiar signo parte imaginaria" }
      ],
      "extremo": [
        { pregunta: "Resuelve ecuación diferencial dy/dx = 3x²", respuesta: "y = x³ + C", explicacion: "Integrar función" },
        { pregunta: "Calcula transformada de Laplace", respuesta: "Varía", explicacion: "Transformada integral" },
        { pregunta: "Deriva función compuesta f(x) = e^{3x}", respuesta: "3e^{3x}", explicacion: "Regla cadena" },
        { pregunta: "Calcula series de Fourier", respuesta: "Varía", explicacion: "Descomposición en senos y cosenos" },
        { pregunta: "Calcula eigenvalores matriz 3x3", respuesta: "Varía", explicacion: "Álgebra lineal avanzada" },
        { pregunta: "Resuelve integral definida ∫_0^1 x dx", respuesta: "0.5", explicacion: "Integral definida" },
        { pregunta: "Calcula límite lim x→∞ (1 + 1/x)^x", respuesta: "e", explicacion: "Definición de e" },
        { pregunta: "Calcula derivada implícita", respuesta: "Varía", explicacion: "Derivación" },
        { pregunta: "Resuelve sistema no lineal avanzado", respuesta: "Varía", explicacion: "Sistemas complejos" },
        { pregunta: "Calcula valor esperado variable aleatoria", respuesta: "Varía", explicacion: "Probabilidades y resultados" }
      ]
    }
  };

  const tiemposDificultad = {
    "facil": 8 * 60,
    "medio": 6 * 60,
    "dificil": 4 * 60,
    "extremo": 3 * 60
  };

  // Variables UI
  const cursoSelect = document.getElementById("curso-select");
  const dificultadSelect = document.getElementById("dificultad-select");
  const startBtn = document.getElementById("start-btn");
  const board = document.getElementById("board");
  const explanationDiv = document.getElementById("explanation");
  const scoreboard = document.getElementById("scoreboard");
  const timerDisplay = document.getElementById("timer");

  let cursoActual = cursoSelect.value;
  let dificultadActual = dificultadSelect.value;
  let puntaje = 0;
  let cartasSeleccionadas = [];
  let temporizador = null;
  let tiempoRestante = 0;

  // Actualiza color del tablero según dificultad
  function actualizarColorBoard() {
    board.className = `board-${dificultadActual}`;
  }

  // Crea cartas aleatorias basadas en curso y dificultad
  function crearCartas() {
    board.innerHTML = "";
    cartasSeleccionadas = [];
    puntaje = 0;
    actualizarPuntaje();
    explanationDiv.textContent = "";
    clearInterval(temporizador);

    cursoActual = cursoSelect.value;
    dificultadActual = dificultadSelect.value;

    const ejercicios = bancoOperaciones[cursoActual]?.[dificultadActual];
    if (!ejercicios) {
      explanationDiv.textContent = "No hay ejercicios para esta combinación.";
      return;
    }

    // Tomar 8 ejercicios aleatorios para el memorice
    const seleccionados = [];
    const usadosIndices = new Set();
    while (seleccionados.length < 8 && usadosIndices.size < ejercicios.length) {
      const i = Math.floor(Math.random() * ejercicios.length);
      if (!usadosIndices.has(i)) {
        usadosIndices.add(i);
        seleccionados.push(ejercicios[i]);
      }
    }

    // Por cada ejercicio creamos dos cartas: pregunta y respuesta
    const cartas = [];
    seleccionados.forEach((e, idx) => {
      cartas.push({ id: idx, text: e.pregunta, tipo: "pregunta", respuesta: e.respuesta, explicacion: e.explicacion });
      cartas.push({ id: idx, text: e.respuesta, tipo: "respuesta", respuesta: e.respuesta, explicacion: e.explicacion });
    });

    // Mezclar cartas
    cartas.sort(() => Math.random() - 0.5);

    // Crear elementos DOM para cartas
    cartas.forEach(carta => {
      const div = document.createElement("div");
      div.classList.add("card");
      div.dataset.id = carta.id;
      div.dataset.tipo = carta.tipo;
      div.dataset.respuesta = carta.respuesta;
      div.dataset.explicacion = carta.explicacion;
      div.textContent = "";
      div.addEventListener("click", manejarClickCarta);
      board.appendChild(div);
    });

    iniciarTemporizador();
    actualizarColorBoard();
  }

  function manejarClickCarta(e) {
    const carta = e.currentTarget;
    if (carta.classList.contains("flipped") || carta.classList.contains("matched")) return;

    carta.classList.add("flipped");
    carta.textContent = carta.dataset.tipo === "pregunta" ? carta.dataset.text : carta.dataset.respuesta;

    cartasSeleccionadas.push(carta);

    if (cartasSeleccionadas.length === 2) {
      const [primera, segunda] = cartasSeleccionadas;
      // Solo son par si mismo id pero diferente tipo
      if (
        primera.dataset.id === segunda.dataset.id &&
        primera.dataset.tipo !== segunda.dataset.tipo
      ) {
        // Par correcto
        primera.classList.add("matched");
        segunda.classList.add("matched");
        puntaje += 10;
        explanationDiv.textContent = "¡Correcto! " + primera.dataset.explicacion;
      } else {
        // Par incorrecto
        puntaje = Math.max(0, puntaje - 5);
        explanationDiv.textContent = "Incorrecto. " + (segunda.dataset.explicacion || "Revisa bien el ejercicio.");
        // Mostrar temporalmente color rojo y después ocultar texto
        primera.classList.add("wrong");
        segunda.classList.add("wrong");
        setTimeout(() => {
          primera.classList.remove("flipped", "wrong");
          segunda.classList.remove("flipped", "wrong");
          primera.textContent = "";
          segunda.textContent = "";
          explanationDiv.textContent = "";
        }, 1500);
      }
      actualizarPuntaje();
      cartasSeleccionadas = [];
      revisarFinJuego();
    }
  }

  function actualizarPuntaje() {
    scoreboard.textContent = `Puntaje: ${puntaje}`;
  }

  function revisarFinJuego() {
    const todasCartas = Array.from(board.querySelectorAll(".card"));
    if (todasCartas.every(c => c.classList.contains("matched"))) {
      clearInterval(temporizador);
      explanationDiv.textContent = "¡Felicidades! Terminaste el juego.";
    }
  }

  function iniciarTemporizador() {
    clearInterval(temporizador);
    tiempoRestante = tiemposDificultad[dificultadActual];
    actualizarTiempo();
    temporizador = setInterval(() => {
      tiempoRestante--;
      actualizarTiempo();
      if (tiempoRestante <= 0) {
        clearInterval(temporizador);
        explanationDiv.textContent = "¡Se acabó el tiempo!";
        bloquearCartas();
      }
    }, 1000);
  }

  function actualizarTiempo() {
    const minutos = Math.floor(tiempoRestante / 60).toString().padStart(2, "0");
    const segundos = (tiempoRestante % 60).toString().padStart(2, "0");
    timerDisplay.textContent = `Tiempo: ${minutos}:${segundos}`;
  }

  function bloquearCartas() {
    const todasCartas = Array.from(board.querySelectorAll(".card"));
    todasCartas.forEach(c => {
      c.removeEventListener("click", manejarClickCarta);
      c.classList.add("flipped");
      // Mostrar texto para que el jugador vea
      c.textContent = c.dataset.tipo === "pregunta" ? c.dataset.text : c.dataset.respuesta;
    });
  }

  startBtn.addEventListener("click", crearCartas);

  // Ajustar para que al cambiar selecciones actualice el color
  cursoSelect.addEventListener("change", () => {
    cursoActual = cursoSelect.value;
  });
  dificultadSelect.addEventListener("change", () => {
    dificultadActual = dificultadSelect.value;
    actualizarColorBoard();
  });

  // Inicializar color y timer vacío
  actualizarColorBoard();
  timerDisplay.textContent = "Tiempo: 00:00";
</script>

</body>
</html>
